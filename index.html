<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Heera Medical - Powered by NS SIDD</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00796b">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background-color: #f0f2f5; font-family: sans-serif; }
        iframe { border:none; width:100%; height:100%; display: none; }
        
        #pwaInstallModal { 
            position: fixed; inset: 0; z-index: 999999; 
            background: #111827;
            display: flex; align-items: center; justify-content: center; 
            text-align: center; color: white;
        }

        .box {
            background: #ffffff; color: #333; padding: 30px;
            border-radius: 25px; width: 85%; max-width: 350px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        .install-btn {
            width: 100%; background: #00796b; color: white;
            padding: 16px; border: none; border-radius: 12px;
            font-size: 18px; font-weight: bold; cursor: pointer;
            margin-top: 15px;
        }

        .manual-inst {
            display: none; background: #fff3cd; color: #856404;
            padding: 15px; border-radius: 10px; font-size: 13px;
            margin-top: 15px; border: 1px solid #ffeeba; text-align: left;
        }
    </style>
</head>
<body>

    <iframe id="mainApp" src="https://script.google.com/macros/s/AKfycbwkSXbezhGZ_Zaf7LhlSC8AtJRqeCmNAKWvMTz7AS7-ckFdHrqJrjmzvHEkbeAEslocGg/exec"></iframe>

    <div id="pwaInstallModal">
        <div class="box">
            <div style="font-size: 50px;">üè•</div>
            <h2 style="margin:10px 0;">Heera Medical</h2>
            <p style="color: #666; font-size: 14px;">Please install the application to continue.</p>
            
            <button id="pwaInstallBtn" class="install-btn">INSTALL NOW</button>

            <div id="manualInstructions" class="manual-inst">
                <strong>Manual Install:</strong><br>
                1. Click on Browser Menu (3 dots/Share)<br>
                2. Select <b>'Install App'</b> or <b>'Add to Home Screen'</b>.
            </div>
            
            <div style="margin-top:20px; font-size:11px; color:#aaa;">Managed by NS SIDD TUTORIAL</div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('pwaInstallModal');
        const iframe = document.getElementById('mainApp');
        const manual = document.getElementById('manualInstructions');
        let deferredPrompt;

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }

        // Hard Lock Logic
        function checkStatus() {
            const isPWA = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            if (isPWA) {
                modal.style.display = 'none';
                iframe.style.display = 'block';
            } else {
                modal.style.display = 'flex';
                iframe.style.display = 'none';
            }
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        document.getElementById('pwaInstallBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
            } else {
                // Alert ke bajaye box dikhao
                manual.style.display = 'block';
            }
        });

        setInterval(checkStatus, 1000);
        checkStatus();
    </script>
</body>
</html>
