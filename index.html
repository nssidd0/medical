<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Demo</title>
    <link rel="icon" type="image/png" href="./logo.png">
    <link rel="shortcut icon" type="image/png" href="./logo.png">
    <link rel="apple-touch-icon" href="./logo.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#dc2626">
    <style>
        body, html { margin:0; padding:0; height:100%; overflow:hidden; background-color: #111827; }
        iframe { border:none; width:100%; height:100%; }
        
        /* CSS Animation for the Install Icon */
        @keyframes bounce-arrow {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
        }
    </style>
</head>
<body>
    <iframe src="https://script.google.com/macros/s/AKfycbyCMckc-onwbO1mQLh9qCRbun12DvPwQtJ7XY4xNsCNENwJFxg1gFzRAUt_OQNjvlXB/exec" allowfullscreen></iframe>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
      
      // 1. Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
          .then(() => console.log('SW Registered'))
          .catch((err) => console.log('SW Error:', err));
      }

      // 2. iOS Detection
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

      // 3. Popup HTML (With CSS Animation - No GIF)
      const popupHTML = `
        <div id="pwaInstallModal" style="display: none; position: fixed; inset: 0; z-index: 2147483647; background-color: rgba(0,0,0,0.9); align-items: center; justify-content: center; backdrop-filter: blur(8px);">
            <div style="background-color: #111827; border: 1px solid #374151; padding: 30px 24px; border-radius: 20px; width: 90%; max-width: 320px; text-align: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); position: relative;">
            
                <div style="
                    width: 70px; 
                    height: 70px; 
                    background: linear-gradient(135deg, #dc2626, #ef4444); 
                    border-radius: 50%; 
                    display: flex; 
                    align-items: center; 
                    justify-content: center; 
                    margin: 0 auto 20px auto; 
                    animation: pulse-ring 2s infinite;
                ">
                    <span style="font-size: 32px; color: white; animation: bounce-arrow 2s infinite;">‚¨áÔ∏è</span>
                </div>

                <h3 style="color: white; font-size: 22px; font-weight: 800; margin-bottom: 8px; font-family: system-ui, -apple-system, sans-serif;">Install App</h3>
                <p style="color: #9ca3af; font-size: 14px; margin-bottom: 24px; font-family: system-ui, -apple-system, sans-serif; line-height: 1.5;">Get the full screen experience with faster access.</p>

                <button id="pwaInstallBtn" style="width: 100%; background: white; color: black; font-weight: 700; padding: 14px; border-radius: 12px; border: none; cursor: pointer; font-size: 16px; transition: transform 0.2s;">
                    Install Now
                </button>
            </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', popupHTML);

      // 4. Logic
      let deferredPrompt;
      const modal = document.getElementById('pwaInstallModal');
      const installBtn = document.getElementById('pwaInstallBtn');

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        setTimeout(() => { modal.style.display = 'flex'; }, 3000);
      });

      installBtn.addEventListener('click', async () => {
        // Simple Bounce Animation on Click
        installBtn.style.transform = "scale(0.95)";
        setTimeout(()=> installBtn.style.transform = "scale(1)", 150);

        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            modal.style.display = 'none'; 
        } else if (isIOS) {
            alert("Tap Share Icon > Add to Home Screen");
            modal.style.display = 'none';
        } else {
            alert("App already installed.");
            modal.style.display = 'none';
        }
      });
        // ==========================================
      // 5. OFFLINE / NO INTERNET DETECTION
      // ==========================================
      
      // HTML for Offline Message
      const offlineHTML = `
        <div id="offlineModal" style="display: none; position: fixed; inset: 0; z-index: 2147483648; background-color: #111827; align-items: center; justify-content: center; flex-direction: column; text-align: center;">
            <div style="font-size: 50px; margin-bottom: 20px;">üì°</div>
            <h2 style="color: white; font-family: sans-serif; margin-bottom: 10px;">No Internet</h2>
            <p style="color: #9ca3af; font-family: sans-serif;">Please check your connection.</p>
            <button onclick="window.location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 8px; font-weight: bold;">Try Again</button>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', offlineHTML);

      function updateOnlineStatus() {
        const offlineModal = document.getElementById('offlineModal');
        if (navigator.onLine) {
            offlineModal.style.display = 'none';
        } else {
            offlineModal.style.display = 'flex';
        }
      }

      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      
      // Check on load
      updateOnlineStatus();
    });
    </script>
</body>
</html>


